<mat-card class="ft-card">

  <div class="page-crud-title">
    <h2>Saisie et mise à jour d'une fiche technique — Service de confiance</h2>
  </div>

  <div class="two-col two-col--75-25">

    <section class="list-box fiche-technique-box">
      <div class="list-header">
        <h3 class="list-title">Fiche technique</h3>
      </div>

      <div class="list-body">
        <form [formGroup]="form" class="form-grid">

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Client</mat-label>
            <input
              matInput
              [(ngModel)]="nomClient"
              [matAutocomplete]="auto_cl"
              formControlName="client"
              placeholder="Nom du client">
            <mat-autocomplete #auto_cl="matAutocomplete">
              <mat-option
                *ngFor="let item of clients | search: nomClient"
                (click)="onGetClient(item)"
                [value]="item.denomination_sociale">
                <span>{{ item.denomination_sociale }}</span>
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Service de confiance</mat-label>
            <mat-select formControlName="produit" matTooltip="Service de confiance">
              <mat-option *ngFor="let item of produits" [value]="item.id">
                {{ item.libelle }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Commentaire (ce commentaire ne sera pas visible sur la facture)</mat-label>
            <textarea matInput rows="2" formControlName="commentaire" autofocus></textarea>
          </mat-form-field>

          <div class="form-actions form-actions--buttons">
            <button
              mat-flat-button
              class="custom-save-button"
              type="button"
              *ngIf="data_operation===operations.create || data_operation===operations.update"
              (click)="crud()">
              <mat-icon>save</mat-icon> Enregistrer
            </button>

            <button
              mat-flat-button
              color="primary"
              type="button"
              *ngIf="data_operation===operations.transmettre"
              (click)="onTransmettre()">
              Transmettre
            </button>

            <button mat-stroked-button class="custom-close-button" type="button" (click)="onFerme()">
              <mat-icon>close</mat-icon> Fermer
            </button>
          </div>
        </form>
      </div>

      <div align="center">
        <avis-technique-infos
          [ficheTechnique]="ficheTechnique">
        </avis-technique-infos>
      </div>

    </section>

    <section class="list-box historique-box">
      <div class="list-header">
        <h3 class="list-title">Historique de la demande</h3>
      </div>

      <div class="list-body">
        <historique-traitement
          [historiqueFicheTechniques]="historiqueFicheTechniques">
        </historique-traitement>
      </div>
    </section>

  </div>
</mat-card>