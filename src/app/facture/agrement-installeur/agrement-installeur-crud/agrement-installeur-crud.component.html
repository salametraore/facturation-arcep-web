<!-- src/app/features/agrement-installateur/fiche-technique/ai-ft-edit-page.component.html -->
<mat-card>

  <!-- Titre de page -->
  <div class="page-title">
    <h2>Saisie et mise à jour d'une fiche technique — Agrément d’installateur</h2>
  </div>

  <!-- Grille 2 colonnes : 75% / 25% -->
  <div class="two-col two-col--75-25">

    <!-- ===== Colonne gauche : FICHE TECHNIQUE ===== -->
    <section class="list-box">
      <div class="list-header">
        <h3 class="list-title">Fiche technique</h3>

        <!-- Actions alignées à droite -->
        <div class="list-actions">
          <button
            mat-flat-button
            color="primary"
            *ngIf="operation===operations.create || operation===operations.update"
            (click)="crud()">
            <mat-icon>save</mat-icon>
            Enregistrer
          </button>

          <button mat-stroked-button color="primary" (click)="onRetour()">
            <mat-icon>undo</mat-icon>
            Retour
          </button>

          <button
            mat-flat-button
            color="warn"
            *ngIf="operation===operations.transmettre"
            (click)="onTransmettre()">
            <mat-icon>send</mat-icon>
            Transmettre
          </button>
        </div>
      </div>

      <div class="list-body">
        <form [formGroup]="form" class="form-grid">

          <!-- Client (autocomplete) 70% + Catégorie 30% -->
          <div class="row-70-30">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Client</mat-label>
              <input
                matInput
                placeholder="Nom du client"
                matTooltip="Nom du client"
                [matAutocomplete]="auto_cl"
                [(ngModel)]="nomClient"
                formControlName="client">
              <mat-autocomplete #auto_cl="matAutocomplete">
                <mat-option
                  *ngFor="let item of clients | search: nomClient"
                  (click)="onGetClient(item)"
                  [value]="item.denomination_sociale">
                  <span>{{ item.denomination_sociale }}</span>
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>

            <div class="blank-row"></div>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Catégorie de service</mat-label>
              <mat-select formControlName="produit" matTooltip="Catégorie de service">
                <mat-option *ngFor="let item of produits" [value]="item.id">
                  {{ item.libelle }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="blank-row"></div>

          <!-- Commentaire -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Commentaire (ce commentaire ne sera pas visible sur la facture)</mat-label>
            <textarea matInput formControlName="commentaire" rows="1"></textarea>
          </mat-form-field>

          <div align="center"  *ngIf="ficheTechnique &&  ficheTechnique?.statut?.id > 5">
            <avis-technique-infos
              [ficheTechnique]="ficheTechnique">
            </avis-technique-infos>
          </div>

        </form>
      </div>
    </section>

    <!-- ===== Colonne droite : HISTORIQUE ===== -->
    <section class="list-box">
      <div class="list-header">
        <h3 class="list-title">Historique de la demande</h3>
      </div>
      <div class="list-body">
        <historique-traitement
          [historiqueFicheTechniques]="historiqueFicheTechniques">
        </historique-traitement>
      </div>
    </section>

  </div> <!-- /two-col -->
</mat-card>
