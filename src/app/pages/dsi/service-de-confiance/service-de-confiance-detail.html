<div *ngIf="item; else loading" class="detail-container">
  <h2 class="page-title">Traiter la demande de {{ item.name }}</h2>

  <!-- √âtapes de traitement -->
  <div class="stepper">
    <div *ngFor="let step of steps; let i = index"
         class="step"
         [class.active]="i === currentStep"
         [class.completed]="i < currentStep"
         [attr.title]="step.description"
         (click)="goToStep(i)">
      <div class="step-circle">{{ i + 1 }}</div>
      <div class="step-label">{{ step.label }}</div>
      <div class="step-line" *ngIf="i < steps.length - 1"></div>
    </div>
  </div>

  <div class="content-wrapper">
    <!-- üìÑ Fiche technique -->
    <div class="left-panel">
      <h3>Fiche technique</h3>

      <!-- <mat-card class="info-card">
        <mat-card-content>
          <p><strong>Nom du prestataire :</strong> {{ item.name }}</p>
          <p><strong>Cat√©gorie actuelle :</strong> {{ item.serviceCategory }}</p>
          <p><strong>Date de r√©ception :</strong> {{ item.receivedAt | date:'dd/MM/yyyy' }}</p>
          <p><strong>Statut :</strong>
            <span class="status" [ngClass]="item.status">{{ item.status | titlecase }}</span>
          </p>
        </mat-card-content>
      </mat-card> -->

      <!-- Fichiers attach√©s -->
      <div class="attachments">
        <h4>Fichiers attach√©s</h4>
        <div class="cards">
          <mat-card class="file-card word"><mat-icon>description</mat-icon><span>Word</span></mat-card>
          <mat-card class="file-card pdf"><mat-icon>picture_as_pdf</mat-icon><span>PDF</span></mat-card>
          <mat-card class="file-card excel"><mat-icon>grid_on</mat-icon><span>Excel</span></mat-card>
        </div>
      </div>

      <!-- Zone de traitement -->
      <div class="form-section">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nouvelle cat√©gorie</mat-label>
          <mat-select [(ngModel)]="newStatus">
            <mat-option value="Service de certification √©lectronique">Service de certification √©lectronique</mat-option>
            <mat-option value="Service d'archivage √©lectronique">Service d'archivage √©lectronique</mat-option>
            <mat-option value="Service horodatage √©lectronique">Service horodatage √©lectronique</mat-option>
            <mat-option value="Service de recommand√© √©lectronique">Service de recommand√© √©lectronique</mat-option>
            <mat-option value="Service de num√©risation de documents">Service de num√©risation de documents</mat-option>
            <mat-option value="Syst√®me horodatage √©lectronique">Syst√®me horodatage √©lectronique</mat-option>
            <mat-option value="Syst√®me d'archivage √©lectronique">Syst√®me d'archivage √©lectronique</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Commentaire</mat-label>
          <textarea matInput rows="3" [(ngModel)]="processingNote"></textarea>
        </mat-form-field>

        <div class="button-row">
          <button mat-stroked-button color="warn" (click)="openRejectNotify()">
            <mat-icon>cancel</mat-icon> Rejeter / Notifier client
          </button>
          <button mat-flat-button color="primary" (click)="save()">
            <mat-icon>send</mat-icon> Transmettre
          </button>
        </div>
      </div>
    </div>

    <!-- üìú Historique -->
    <div class="right-panel">
      <h3>Historique de la demande</h3>
      <div class="history-box">
        <div *ngFor="let h of history" class="history-item">
          <div class="history-header">
            <span class="history-date">{{ h.date | date:'dd/MM/yyyy' }}</span>
            <span class="history-action">{{ h.action }}</span>
          </div>
          <p class="history-note">{{ h.note }}</p>
          <mat-divider></mat-divider>
        </div>

        <div *ngIf="history.length === 0" class="empty-state">
          Aucune action enregistr√©e pour le moment.
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <p class="loading-text">Chargement des donn√©es...</p>
</ng-template>
