@use '@angular/material' as mat;

/* ============ THEME MATERIAL (ARCEP Rose) ============ */
@include mat.core();

/* Utilisation de la palette RED avec le shade 800 pour #c62828 */
$primary-color-code: #c62828;
$primary: mat.define-palette(mat.$red-palette, 800);    // ~ #c62828
$accent:  mat.define-palette(mat.$red-palette, A200);   // Teinte pour les √©l√©ments secondaires
$warn:    mat.define-palette(mat.$deep-orange-palette); // Conservez Warn pour les alertes/erreurs

$theme: mat.define-light-theme((
  color: (primary: $primary, accent: $accent, warn: $warn),
  typography: mat.define-typography-config(),
  density: -1
));
@include mat.all-component-themes($theme);

/* ============ VARIABLES CSS (surfaces/texte/bordures) ============ */
:root {
  --brand-primary: #{mat.get-color-from-palette($primary)};
  --brand-primary-contrast: #{mat.get-color-from-palette($primary, default-contrast)};

  /* surfaces & texte */
  --surface: #ffffff;
  --surface-alt: color-mix(in srgb, var(--brand-primary) 10%, #fff 90%);
  --text: #2b2b2b; /* Noir/Gris fonc√© */
  --text-muted: #5a5a5a;

  /* bordures */
  --border-weak:  color-mix(in srgb, var(--brand-primary) 22%, #fff 78%);
  --border-strong: color-mix(in srgb, var(--brand-primary) 40%, #fff 60%);
}

/* SCSS legacy (si besoin ponctuel) */
$brand: #ad1457;
$brand-600: #c2185b;
$brand-400: #ec407a;

/* Fallback si color-mix n‚Äôest pas support√© */
@supports not (color: color-mix(in srgb, #000, #fff)) {
  :root {
    --border-weak:  #e8b9cc;
    --border-strong:#d98aa8;
    --surface-alt: #fff6fa;
  }
}

/* ============ GLOBAL / WATERMARK ============ */
html, body { height: 100%; background: #FAFAFA; color: var(--text); }

mat-sidenav-content { position: relative; min-height: 100%; }
mat-sidenav-content::before {
  content: "";
  position: absolute; inset: 0;
  background-image: url("/assets/images/arcep-logo.png");
  background-repeat: no-repeat;
  background-position: center 20%;
  background-size: 520px auto;
  opacity: 0.06; pointer-events: none; z-index: 0;
}
mat-sidenav-content > * { position: relative; z-index: 1; }

@media print { mat-sidenav-content::before { display: none; } }

/* ============ SIDENAV ============ */
.sidenav {
  background-color: var(--surface);
  color: var(--text);
  box-shadow: 2px 0 6px rgba(0,0,0,0.1);
}

/* Styles des liens (mat-list-item) */
.sidenav .mat-list-item,
.sidenav a.mat-list-item {
  color: var(--text);
  border-radius: 10px;
  margin: 4px 6px;
  font-weight: 500;
  background: transparent !important;
}

/* üü• Style au survol (hover) en rose/rouge */
.sidenav a.mat-list-item:hover,
.sidenav mat-nav-list a.mat-list-item:hover {
  background: color-mix(in srgb, var(--brand-primary) 18%, #fff 82%) !important;
  color: var(--text) !important;
}

/* üü• Style de l'√©l√©ment ACTIF (Fond Rouge ARCEP et Texte/Ic√¥ne Blanc) ‚¨ú */
.sidenav a.mat-list-item.active-link {
    background-color: var(--brand-primary) !important;
    color: var(--brand-primary-contrast) !important;
    font-weight: 600 !important;
}
.sidenav a.mat-list-item.active-link .mat-icon {
    color: var(--brand-primary-contrast) !important;
}

/* Expansion panel (m√™me marge que les liens) */
.menu-panel.mat-expansion-panel {
  background: transparent;
  box-shadow: none;
  border: none;
  border-radius: 10px;
  margin: 4px 6px;
}
.menu-panel .mat-expansion-panel-header { background: transparent; }
.menu-panel .mat-expansion-panel-header {
  color: var(--text);
  font-weight: 500;
}
.menu-header { color: var(--text); }
.menu-header .mat-icon { color: var(--text); }

/* Titres des modules (en-t√™te des panneaux) en gras */
.sidenav .mat-expansion-panel-header-title {
  font-weight: 700;
}

/* Items de 1er niveau (modules SANS sous-menus) en gras */
.sidenav mat-nav-list > a.mat-mdc-list-item .mdc-list-item__primary-text {
  font-weight: 600;
}


/* ============ TOOLBAR / TITRE (FIX DEFINITIF) ============ */
mat-toolbar { height: 30px; padding: 0 4px; } /* Force la hauteur √† 30px */

/* CORRECTION ALIGNEMENT : on s'assure que les √©l√©ments du row sont bien centr√©s */
mat-toolbar .mat-mdc-toolbar-row {
  min-height: 30px;
  align-items: center; /* Centrage vertical */
  height: 30px; /* Force la hauteur */
}

/* Cible la mat-toolbar avec color="primary" et la classe app-toolbar */
.mat-toolbar.mat-primary.app-toolbar {
  background-color: var(--surface) !important; /* Fond Blanc */
  color: var(--text) !important; /* Texte Noir */
  box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
  padding: 0 8px 0 0; /* Petit padding √† droite, aucun √† gauche */
}

/* Boutons et Ic√¥nes dans la Toolbar principale (couleur par d√©faut : Noir) */
.mat-toolbar.mat-primary.app-toolbar .mat-icon,
.mat-toolbar.mat-primary.app-toolbar button {
  /* FIX VISIBILIT√â : Force la couleur de l'ic√¥ne √† Noir pour qu'elle soit visible */
  color: var(--text) !important; 
  opacity: 1 !important; /* S'assurer qu'elles ne sont pas transparentes */
  
  margin: 0; /* Suppression des marges externes par d√©faut */
  padding: 0; /* Suppression des paddings par d√©faut du bouton */
  height: 30px; /* Taille compacte */
  width: 30px; /* Taille compacte */
}

/* Le bouton burger a souvent besoin d'un ajustement sp√©cifique pour coller au bord gauche */
.mat-toolbar.mat-primary.app-toolbar button:first-child {
  margin-left: -8px; /* Tire l√©g√®rement le premier bouton vers la gauche (ajustement visuel) */
}

/* ‚ùå FIX FINAL ANTI-CERCLE : Supprime le fond et l'effet de survol */
.mat-toolbar.mat-primary.app-toolbar .mat-mdc-icon-button {
  /* Annule les effets de survol de MD3 */
  --mat-icon-button-state-layer-color: transparent !important;
  --mat-icon-button-hover-state-layer-opacity: 0 !important;
  --mat-icon-button-focus-state-layer-opacity: 0 !important;
  --mat-icon-button-pressed-state-layer-opacity: 0 !important;
}

/* Fallback/R√®gle plus g√©n√©rale pour s'assurer que l'ombre/le fond disparaissent */
.mat-toolbar.mat-primary.app-toolbar button:hover {
  background-color: transparent !important;
  box-shadow: none !important;
}
.mat-toolbar.mat-primary.app-toolbar .mat-mdc-button-persistent-ripple::before {
  background-color: transparent !important;
  opacity: 0 !important;
}


/* üöÄ Effet de Survol SOUHAIT√â : Ic√¥nes de la Toolbar au Survol (Hover) : Couleur Rouge ARCEP */
.mat-toolbar.mat-primary.app-toolbar button:hover .mat-icon,
.mat-toolbar.mat-primary.app-toolbar .auth-btn:hover .mat-icon {
  color: var(--brand-primary) !important; /* Rouge ARCEP */
}


/* Le titre central : SUPPRESSION DU RECTANGLE */
.app-toolbar .app-title {
  display: inline-flex; align-items: center;
  padding: 0;
  margin-left: 8px;
  border-radius: 0;
  background-color: transparent;
  border: none;
  color: var(--text);
  font-weight: 600; line-height: 1.2; white-space: nowrap;
}

/* ============ BLOCS / CARTES / LISTES ============ */
.list-box, mat-card.card, mat-card.list-box {
  background: var(--surface);
  border: 2px solid;
  border-color: #c2c2c2;
  //border-radius: 8px;
  box-shadow: none;
}
.list-header{
  display: flex; align-items: center; gap: 12px;
  padding: 10px 12px;
  border-bottom: 2px solid;
  border-color: #ffc421 !important;
}
.list-title{ 
  color: #222222 !important;
  margin: .25rem 0 !important;
  font-weight: 600 !important;
  font-size: 16px !important; 
}
.list-actions{ margin-left: auto; display: flex; gap: 8px; }
.list-body{ padding: 10px 12px 12px; }
.blank-row{ height: 12px; }

/* boutons */
.btn_details { color: $brand; }
.btn_edit    { color: $brand; }
.btn_delete  { color: #d32f2f; }
.primary     { color: $brand; text-align: center; }
button { margin-left: 5px; }

/* ============ TABLES ============ */
.mat-mdc-table .mat-mdc-header-row {
  background-color: var(--brand-primary);
  color: var(--brand-primary-contrast);
}
.mat-mdc-table .mat-mdc-header-cell { color: var(--brand-primary-contrast); }
.mat-mdc-table .mat-sort-header-arrow { color: var(--brand-primary-contrast) !important; opacity: 1 !important; }
.mat-mdc-table .mat-mdc-header-row.mat-mdc-table-sticky { border-bottom: 1px solid rgba(0,0,0,.12); }

/* Zebra rose clair */
.mat-mdc-table .mat-mdc-row { height: 30px; }
.mat-mdc-table .mat-mdc-row:not(.selected):nth-child(odd)  { background-color: #fff; }
.mat-mdc-table .mat-mdc-row:not(.selected):nth-child(even) { background-color: color-mix(in srgb, var(--brand-primary) 8%, #fff 92%); }
.mat-mdc-table .mat-mdc-row:not(.selected):hover { background-color: color-mix(in srgb, var(--brand-primary) 14%, #fff 86%); }
.selected { background-color: color-mix(in srgb, var(--brand-primary) 28%, #fff 72%) !important; }
.mat-mdc-table .mat-mdc-cell, .mat-mdc-table .mat-mdc-footer-cell { border-bottom: 1px solid rgba(0,0,0,.06); }

/* Paginator ic√¥nes en primaire */
.mat-mdc-paginator {
  --mat-paginator-container-size: 36px;
  --mat-paginator-enabled-icon-color: var(--brand-primary);
}
.compact-table {
  border: 1px solid var(--border-strong);
  border-radius: 8px;
  overflow: hidden;
}

/* ============ FILTRES (centr√©s, compacts) ============ */
.filters{
  display: flex; justify-content: center;
  border: 2px solid var(--brand-primary) !important;
  border-radius: 8px; background: #fff;
  padding: 12px 14px; margin-bottom: 12px;
}
.filters-grid{
  display: grid;
  grid-template-columns: repeat(5, 220px);
  gap: 10px; align-items: end; justify-content: center;
}
.filters mat-form-field{ width: 220px; margin: 0; }
.filters .mdc-text-field--outlined{
  height: 40px;
  --mdc-outlined-text-field-outline-color: color-mix(in srgb, var(--brand-primary) 45%, #6b6b6b);
  --mdc-outlined-text-field-hover-outline-color: color-mix(in srgb, var(--brand-primary) 55%, #545454);
  --mdc-outlined-text-field-focus-outline-color: var(--brand-primary);
}
.filters .mat-mdc-form-field-infix{ padding: 8px 0 10px; }
.filters .mat-mdc-form-field-subscript-wrapper{ display: none; }

@media (max-width: 1400px){ .filters-grid{ grid-template-columns: repeat(4, 220px); } }
@media (max-width: 1100px){ .filters-grid{ grid-template-columns: repeat(3, 220px); } }
@media (max-width: 800px) { .filters-grid{ grid-template-columns: repeat(2, 220px); } }

/* Variante "une ligne sans scroll" */
.filters--one-line { overflow: hidden; }
.filters--one-line .filters-grid {
  display: grid;
  grid-template-columns: repeat(5, minmax(140px, 1fr)) 40px 40px;
  column-gap: 10px; align-items: end; justify-content: stretch;
}
.filters--one-line .filters-grid mat-form-field { width: 100%; margin: 0; }
.filters--one-line .filters-grid .action-btn { width: 40px; height: 40px; align-self: end; }
@media (max-width: 1280px) {
  .filters--one-line .filters-grid { grid-template-columns: repeat(5, minmax(130px, 1fr)) 40px 40px; }
}
@media (max-width: 1100px) {
  .filters--one-line .filters-grid { grid-template-columns: repeat(5, minmax(120px, 1fr)) 40px 40px; }
}
.filters--one-line .mdc-text-field--outlined { height: 38px; }
.filters--one-line .mat-mdc-form-field-infix { padding: 6px 0 8px; }

/* ============ FORM / DIALOGS ============ */
.form-grid{ display: flex; flex-direction: column; gap: 12px; }
.form-section-title{ font-weight: 600; margin-top: 6px; color: #444; }
.radio-line{ display: flex; gap: 24px; align-items: center; padding: 4px 2px; }
.form-actions{ display: flex; justify-content: flex-end; gap: 10px; margin-top: 6px; }

.dialog-title-rose{
  background: var(--brand-primary);
  color: var(--brand-primary-contrast);
  border: 2px solid var(--brand-primary);
  border-radius: 6px 6px 0 0;
  padding: 10px 12px; margin: 0; font-size: 1.1rem; font-weight: 600;
}
.dialog-content{ padding: 12px !important; }
.list-box--compact .list-header{ padding: 8px 10px; }
.list-box--compact .list-body{ padding: 10px 10px 12px; }

/* ============ PAGE TITLE BAR ============ */
.page-title{
  background: var(--brand-primary);
  color: var(--brand-primary-contrast);
  border: 2px solid var(--brand-primary) !important;
  border-radius: 8px;
  padding: 10px 12px; margin-bottom: 12px;
}
.page-title h2{ margin: 0; font-size: 1.3rem; font-weight: 600; }
.page-title.with-icon{ display: flex; align-items: center; gap: 8px; }
.page-title.with-icon .mat-icon{ color: var(--brand-primary-contrast); }

.page-crud-title{
  background: #ffc421;
  color: var(--brand-primary-contrast);
  border-radius: 0px;
  padding: 10px 0px 0px 12px;
  margin-bottom: 12px;
}

.page-crud-title h2 {
    color: #ffffff;
    font-size: 16px;
    text-transform: uppercase;
    margin-bottom: 20px;
}
/* ============ CHECKBOX / RADIO COULEURS MARQUE ============ */
mat-checkbox {
  --mdc-checkbox-selected-focus-state-layer-color: #{$brand};
  --mdc-checkbox-selected-checkmark-color: white;
  --mdc-checkbox-selected-focus-icon-color: #{$brand};
  --mdc-checkbox-selected-hover-icon-color: #{$brand-600};
  --mdc-checkbox-selected-icon-color: #{$brand};
}
.mat-mdc-radio-button.mat-accent {
  --mdc-radio-selected-focus-icon-color: #{$brand};
  --mdc-radio-selected-hover-icon-color: #{$brand};
  --mdc-radio-selected-icon-color: #{$brand};
  --mdc-radio-selected-pressed-icon-color: #{$brand};
  --mat-radio-checked-ripple-color: #{$brand-400};
}

/* ============ TIMELINE CARDS ============ */
.mat-mdc-card.timeline-card,
.mat-mdc-card.dark-card {
  background-color: color-mix(in srgb, var(--brand-primary) 8%, #fff 92%) !important;
}
@supports not (color: color-mix(in srgb, #000, #fff)) {
  .mat-mdc-card.timeline-card,
  .mat-mdc-card.dark-card { background-color: #fbe8f1 !important; }
}

/* Scrollbar optionnelle */
.timeline-viewport {
  height: 60vh;
  width: 100%;
  overflow: auto;
  padding: 8px 6px;
  box-sizing: border-box;
  scrollbar-gutter: stable;
}

/* garde l‚Äôespacement/arrondis/ombre, mais PAS de background ici */
.dark-card {
  margin: 10px 0;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.timeline-viewport::-webkit-scrollbar { width: 8px; }
.timeline-viewport::-webkit-scrollbar-thumb { background: #bdbdbd; border-radius: 4px; }

.empty { padding: 8px; color: #666; text-align: center; }

/* Carte d'info avec bordure rose clair et fond tr√®s l√©ger */
.info-card {
  border: 2px solid color-mix(in srgb, var(--brand-primary) 35%, #fff 65%) !important;
  background: color-mix(in srgb, var(--brand-primary) 6%, #fff 94%);
  border-radius: 10px;
  padding: 10px 14px;
  box-shadow: none;
}

/* Centrage horizontal + wrap s'il manque de place */
.info-card--center,
.info-card--center .mat-mdc-card-content,
.info-card--center mat-card-content,
.info-card--center .info-line {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  text-align: center;
  margin: 0;
}

/* Fallback si color-mix non support√© */
@supports not (color: color-mix(in srgb, #000, #fff)) {
  .info-card {
    border-color: #e8b9cc;
    background: #fff6fa;
  }
}

/* ============ ACCESSIBILIT√â : focus visible ============ */
.mat-focus-indicator:focus-visible,
button:focus-visible,
a:focus-visible,
.mat-mdc-form-field:focus-within {
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--brand-primary) 30%, #fff 70%);
  border-radius: 6px;
}

/* ============ DIVERS UTILES ============ */
.search-div{ margin: 10px; }
.search-form-field{ width: 70%; }
div[align="end"] { text-align: right; }
.input-full-width{ width: 100%; box-sizing: border-box; }
.spinner-container{
  position: absolute; inset: 0; display:flex; justify-content:center; align-items:center;
  background: rgba(0, 0, 0, 0.32); z-index: 20000;
}
input, textarea { text-transform: uppercase; }
.mat-mdc-button_label { color: white; }
.mat-mdc-menu-item .mat-icon { margin-right: .5rem; }
div[cdkDrag] { cursor: move; }

/* Variante 75 / 25 pour les pages avec historique √† droite */
.two-col--75-25 {
  display: grid;
  grid-template-columns: 3fr 1fr; /* 75% / 25% */
  gap: 1rem;
}

/* M√™me r√®gle de repli que ta grille par d√©faut */
@media (max-width: 1100px){
  .two-col--75-25 { grid-template-columns: 1fr; }
}

/* 2 colonnes √©quilibr√©es comme dans la capture */
.row-2col {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

/* Ligne ‚ÄúAjout de produit‚Äù : tout sur une seule ligne */
.product-row{
  display: grid;
  grid-template-columns:
    minmax(260px, 1.8fr)
    130px
    110px
    140px
    auto;
  gap: 10px;
  align-items: end;
}

/* Largeurs utilitaires pour compacter les champs */
.product-row .field--xl { width: 100%; }
.product-row .field--sm { width: 100%; max-width: 160px; }
.product-row .field--xs { width: 100%; max-width: 120px; }

/* Bouton compact align√© */
.product-row .add-btn{
  height: 40px;
  white-space: nowrap;
  align-self: end;
}

/* R√©activit√© : passe sous 5 colonnes si l‚Äôespace manque */
@media (max-width: 980px){
  .product-row{
    grid-template-columns:
      1fr 120px 100px 120px auto;
  }
}
@media (max-width: 760px){
  .product-row{
    grid-template-columns: 1fr 1fr;
  }
  .product-row .add-btn{ justify-self: start; }
}


/* Ligne √† 2 colonnes 70% / 30% */
.row-70-30{
  display: grid;
  grid-template-columns: 70% 30%;
  gap: 12px;
  align-items: end;
}

/* Empiler en 1 colonne sur √©crans √©troits */
@media (max-width: 900px){
  .row-70-30{
    grid-template-columns: 1fr;
  }
}


/* ====== Ligne d'ajout compacte et align√©e ====== */
.product-row--tight{
  display:flex; align-items:flex-end; gap:10px; flex-wrap:nowrap;
  border:2px solid color-mix(in srgb, var(--brand-primary) 35%, #fff 65%);
  border-radius:8px; padding:10px;
  /* variables de taille uniformes */
  --ui-compact-w: 120px;
  --ui-compact-h: 40px;
}

/* champs : aucune marge basse suppl√©mentaire */
.product-row--tight .product-field{ margin:0; }

/* D√©signation (large) */
.product-row--tight .product-field.designation{
  flex:1 1 auto; min-width:220px;
}

/* Petits champs : m√™me largeur que le bouton */
.product-row--tight .product-field.short{
  flex:0 0 var(--ui-compact-w);
  width:var(--ui-compact-w); max-width:var(--ui-compact-w);
}

/* Hauteur compacte (MD Outlined) */
.product-row--tight .mdc-text-field--outlined{
  height:var(--ui-compact-h);
}
.product-row--tight .mat-mdc-form-field-infix{
  padding:6px 0 8px;
}

/* Bouton ‚ÄúAjouter‚Äù exactement m√™me taille */
.product-row--tight .add-btn{
  width:var(--ui-compact-w);
  height:var(--ui-compact-h);
  align-self:end;
  display:flex; align-items:center; justify-content:center;
  white-space:nowrap; padding:0 12px;
}

/* (optionnel) Tr√®s √©troit : passe √† 2 lignes proprement */
@media (max-width: 900px){
  .product-row--tight{ flex-wrap:wrap; }
  .product-row--tight .add-btn{ width:160px; }
}

.list-header{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px 12px;
  border-bottom:2px solid var(--brand-primary);
}
.list-title{ margin:.25rem 0; font-weight:600; font-size:1.1rem; }
.list-actions{
  margin-left:auto;
  display:flex; gap:8px; flex-wrap:wrap;
}

/* Mise en page des 3 lignes (global, scoped par .facture-edit) */
.facture-edit .row {
  display: grid;
  gap: 16px;
  align-items: start;
}

.facture-edit .cols-70-30 { grid-template-columns: 70% 30%; }
.facture-edit .cols-50-50 { grid-template-columns: 1fr 1fr; }

.facture-edit .row .w-full,
.facture-edit .row .mat-form-field {
  width: 100%;
}

/* Responsive : on empile en mobile */
@media (max-width: 768px) {
  .facture-edit .cols-70-30,
  .facture-edit .cols-50-50 {
    grid-template-columns: 1fr;
  }
}

.facture-edit .form-grid > .row { display: grid !important; }
.facture-edit .row {
  column-gap: 8px;
  row-gap: 12px;
}

/* Optionnel : √©limine toute marge par d√©faut sur les champs */
.facture-edit .row .mat-mdc-form-field {
  margin: 0;
}
.facture-edit .row.grid-50-50 { column-gap: 6px; }